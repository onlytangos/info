<!DOCTYPE html>
<html lang='es'>
<head>
<meta charset='UTF-8'>
<title>OT</title>

<style>
body{
	font-size:12px;
	font-family:Arial,sans-serif;	
}
.datos{
	position:relative;
	top:-1px;
}
img{
	width:12px;
}
h3{
	margin: 0px 20px 0px 0px ;
	color: #222;
	font-size:16px;
	float: left;	
}
h4{
	margin: 0px 40px 0px 0px ;
	color: #666;
	float: right;
}
select{
	width: 100px;
	margin: 0px 8px 0px 0px;	
	font-size: 14px;	
}
.stipo{
	border-radius:0px 10px 10px 0px;
	display: inline-block;
	width: 70px;
	height: 16px;
	text-overflow: ellipsis;
	overflow: hidden;
	white-space: nowrap;		
	z-index:9;
	padding-right:8px;
	padding-left:8px;
}
.stipo2{
	border-radius:0px 8px 8px 0px;
	width: 100px;
	height: 18px;
}
.stipo3{
	border-radius: 0px 10px 10px 0px;
	display: inline-flex;
	width: 80px;
	height: 16px;
	text-overflow: ellipsis;
	overflow: hidden;
	white-space: nowrap;	
	z-index:9;
	padding-right:8px;
	padding-left:8px;
}
.stipo4{
	border-radius:0px 10px 10px 0px;
	display: inline-block;
	width: 80px;
	height: 16px;
	text-overflow: ellipsis;
	overflow: hidden;
	white-space: nowrap;		
	z-index:9;
	padding-right:8px;
	padding-left:8px;
}
.sCity{
	display: inline-block;
	width: 90px;
	height: 14px;	
	text-overflow: ellipsis;
	overflow: hidden;
	white-space: nowrap;
}
.fechaCompacta{
	color:#444;
	padding-right:6px;
	padding-left:2px;
}
.itemLinea{
	display: inline;
}
a:link,a:visited,a:focus,a:active{
	text-decoration: none;
}
a#link:hover{
	margin-left:3px; 
}
a#link{
	width:15px;
	position:relative;
	top:3px;
	z-index:0;
}
.iconoUrl{
	position:relative;
	top:1px;
}
#titulo1{
 	font-size:16px;
}
#titulo2{
 	font-size:12px;
}
#cuenta{
	color: #AAA;
}
#fijo{
	background: #fff;
	position: fixed;
	top: 0px;
	left: 0px;
	width: 100%;
	padding: 20px 10px 20px 10px;
	z-index: 999;
	box-shadow: 0px 0px 6px 0px rgba(0, 0, 0, 0.5);
}
#resultados{
	font-family: "Noto Sans Mono", monospace;
 	font-size:12px;
	float:left;
	width:100%;
	/*position:absolute;*/
	top: 0px;
	left: 150px;
	margin: 20px 0px 0px 0px;


</style>
<script id='fuente1' src='publicEvent.js'></script>
<script id='fuente2' src='publicPeople2.js'></script>
<script id='fuente3' src='privatePeople2.js'></script>
<script>
// ERROR 01 , los primeros selectores tambien son dinamicos
// cuando leer o no los paramtros, solo en la carga ??

// datos
const colArea=0;
const colPais=1;
const colCiudad=2;
const colTipo=3;
const colNombre=4;
const colAutor=5;
const colFecha=6;
const colUrl=7;

// selectores
const fsel0='-all area';
const fsel1='-all country';
const fsel2='-all city';
const fsel3='-all type';
const fsel4='-all dates';
const fsel5='-view';

// globales
var datos=[];
var colorTipo=new Map();
var titulo1,titulo2;
var parametros={};
var ocultar=''; // no mostrar en event, si en people
var checkTxt='Approximate, check the event !!<br/><br/>';
var parametros = {};
var app;

function readParam(){

/* lista de parametros **

app: = mundo o people ; esto determina los selectores que aparecen
area=
pais=
ciudad=
tipo=
fecha=

*/
	
const params = new URLSearchParams(window.location.search);


for (const [clave, valor] of params.entries()) {
  parametros[clave] = valor;
}

if (parametros.app==undefined){
	// no hay parametros
	//console.log('no hay parametros');	
	parametros.app='mundo';
	return;
}

// si no estan en la url poner valores por defecto
if (parametros.area==undefined){parametros.area=fsel0;}
if (parametros.ciudad==undefined){parametros.ciudad=fsel1;}
if (parametros.tipo==undefined){parametros.tipo=fsel2;}
if (parametros.fecha==undefined){parametros.fecha=fsel3;}
if (parametros.area==undefined){parametros.area=fsel4;}
if (parametros.vista==undefined){parametros.vista=fsel5;}

console.log('parametros finales:',parametros);

}

var opcionesVistas=[fsel5,'countries','annual','otra'];
function serSelect(){
	// en funcion de los selectores
	// leer parametros
	// poner los selectores
}

function inicio(){
	readParam();
	app=parametros.app;
	console.log('p:',parametros);
	// datos generales para las vistas
	if (app=='mundo'){
		datos=publicEvent.concat(publicPeople);
		// titulos
		titulo1='Only Tango Info';
		//titulo2='<br/>'+`탱고 링크만 &#128518; 仅限探戈链接 &#128518; タンゴリンクのみ`;
		titulo2='<a href="https://www.facebook.com/profile.php?id=100093497583670" target="_blank">by KoKoTango</a>';

		// mapa colores por tipo
		colorTipo.set('listevents','#ead764');
		colorTipo.set('address','#ffd469');
		colorTipo.set('milonga','#adf5d7');
		colorTipo.set('listmilongas','#aFf5d7');
		colorTipo.set('spot','#cff7f9');
		// eventos
		colorTipo.set('event','#e5f9ff');
		colorTipo.set('event party','#d7f6fa');
		colorTipo.set('event festival','#ceeefe');
		colorTipo.set('event festival','#c3e8ff');
		colorTipo.set('event encuentro','#7db1ff');
		colorTipo.set('event marathon','#acccfc');
		colorTipo.set('event championship','#ff6961');		
		// people publica
		colorTipo.set('dj','#db94ff');
		colorTipo.set('artist','#e4ddff');
		colorTipo.set('organizer','#ebc4ff');
		colorTipo.set('writer','#f9fea0');	
	}
	if(app=='people'){
		datos=privatePeople.concat(publicPeople);
		titulo1=`People &#128518; `;
		titulo2='';

		// mapa colores por tipo
		colorTipo.set('dj','#db94ff');
		colorTipo.set('artist','#e4adff');
		colorTipo.set('organizer','#ccffcc');
		colorTipo.set('tanguera','#ffccff');
		colorTipo.set('tanguero','#ffcccc');
		colorTipo.set('writer','#F9EE90'); // publica eventos
		colorTipo.set('adviser','#F9AA90'); // ayuda	
	}
	//console.log(datos);

	// crear estructura
	const body=document.body;

	// presenta el menu
	const fijo=document.createElement('div');
	fijo.id='fijo';
	body.appendChild(fijo);
	const tt1=document.createElement('span');
	tt1.id='titulo1';
	tt1.innerHTML=titulo1;
	const tt2=document.createElement('span');
	tt2.id='titulo2';	
	tt2.innerHTML='&nbsp;(&nbsp;'+titulo2+'&nbsp;)<br/><br/>';
	
	fijo.appendChild(tt1);
	fijo.appendChild(tt2);

	// crear selectores **
	/*
	if (app=='mundo'){
		fijo.appendChild(crearSel5()); // vista, selector5
	}	
	fijo.appendChild(crearSelAreas()); // selector 0
	fijo.appendChild(crearSel1());
	crearSelCountry(); // selector 1
	fijo.appendChild(crearSel2());
	crearSelCity();  // selector 2
	fijo.appendChild(crearSel3());
	crearSelType(); // selector 3
	if (app=='mundo'){
		fijo.appendChild(crearSel4());crearSelDates(); // fechasa
	}

	*/
	
	// recarga los selectores si hay parametros
	setParametrosSelectores(fijo);
 
	
	// crear listado **
	const results=document.createElement('ul');
	results.id='resultados';
	
	if (app=='mundo'){
		results.style.marginTop='80px';
	}else{
		results.style.marginTop='80px';
	}
	//results.style.marginLeft='-32px'; 
	body.appendChild(results);
	// visualizar
	renderGo();
	//console('end main');
}

function setParametrosSelectores(fijo){
	// los selectores se borran y se crean
	// les cambio el valor dado en los prametros
	// los vuelvo a cargar en cadena
	// los dos primeros son fijos, los otros son dinamicos

	if (app=='mundo'){
		fijo.appendChild(crearSel5()); // vista, selector5
		cambiarValorSelector('selector5',parametros.vista);		
	}
	
	fijo.appendChild(crearSelAreas()); // selector 0
	cambiarValorSelector('selector0',parametros.area);		
	
	fijo.appendChild(crearSel1());
	crearSelCountry(); // selector 1
	cambiarValorSelector('selector1',parametros.pais);	
	
	fijo.appendChild(crearSel2());
	crearSelCity();  // selector 2
	cambiarValorSelector('selector2',parametros.ciudad);		
	
	fijo.appendChild(crearSel3());
	crearSelType(); // selector 3
	cambiarValorSelector('selector3',parametros.tipo);	
	
	if (app=='mundo'){ // fechas
		fijo.appendChild(crearSel4());
		crearSelDates(); 
		cambiarValorSelector('selector4',parametros.fecha);		
	}	
}

function cambiarValorSelector(idSelector, nuevoValor) {
	if (document.getElementById(idSelector)==undefined){return}
	if (nuevoValor==''){return}
	if (!existeValorEnSelect(idSelector,nuevoValor)){return}
	const selector = document.getElementById(idSelector);
	if (selector) {
		selector.value = nuevoValor;
	} else {
		console.warn('no encontro valor en el selector',idSelector,nuevoValor);
	}
}
function existeValorEnSelect(idSelect, valorBuscado) {
  const select = document.getElementById(idSelect);
  if (!select) {
    console.warn(`No se encontró el select con id "${idSelect}"`);
    return false;
  }
  for (let option of select.options) {
    if (option.value === valorBuscado) {
      return true;
    }
  }
}

function crearSel5(){
	// Selector 5 , ver por fecha
	let select=document.createElement('select');
	select.id='selector5';
	//select.style.marginLeft='10px';
	select.addEventListener('change',change5);
	const lista=opcionesVistas;
	lista.forEach(x => {
	  const opt=document.createElement('option');
	  opt.value=x;
	  opt.textContent=x;
	  select.appendChild(opt);
	});
	return select;
}

function crearSel4(){
	// Selector 4 , para tango fechas
	let select=document.createElement('select');
	select.id='selector4';
	select.addEventListener('change',change4);	
	return select;
}

function crearSel3(){
	let select=document.createElement('select');
	select.id='selector3';
	select.addEventListener('change',change3);
	return select;	
}

function crearSel2(){
	// Selector city
	let select=document.createElement('select');
	select.id='selector2';
	select.addEventListener('change',change2);	
	return select;
}

function crearSel1(){
	// Selector country
	let select=document.createElement('select');
	select.id='selector1';
	select.addEventListener('change',change1);	
	return select;
}

function createOpt(s,v,t){
	  const opt=document.createElement('option');
	  opt.value=v;
	  opt.textContent=t;
	  s.appendChild(opt);
}

function crearSelType(){
	let vista='';
	if (document.getElementById('selector5')!=undefined){
		vista=document.getElementById('selector5').value
	}
	let select=document.getElementById('selector3'); 
	select.innerHTML='';

	let optionDefault=document.createElement('option');
	optionDefault.value='';
	optionDefault.textContent=fsel3;
	select.appendChild(optionDefault);

	// grupos
	
	//nota: dejaria de funcionar el selector de fechas dinamico
	//console.log('crearSelType:',app,vista);
	if (app=='mundo'){
		if (vista=='annual'){
			createOpt(select,'event marathon','marathon');
			createOpt(select,'event festival','festival');
			createOpt(select,'event party','party');
			createOpt(select,'event encuentro','encuentro');			
		}else{
			createOpt(select,'event','event*');
			//createOpt(select,'listevents,event,festival,marathon,address,listmilongas,milonga,spot,party','dance*');
			//createOpt(select,'address,listmilongas,milonga,spot,party','milonga*');
			createOpt(select,'artist,organizer,writer,dj','people*');
			let lista=damecol2(colTipo);
			//console.log('XXX:',lista);
			lista.forEach(x => {
				//if (ocultar.indexOf(x)!=-1){return} // no mostrar 
				if (x=='event'){return}
				const opt=document.createElement('option');
				let y=x.replace('event ','').trim();
				opt.value=y;
				opt.textContent=y;
				select.appendChild(opt);
				}
			)			
		}
	}else{
		let lista=damecol2(colFecha);
		lista.forEach(x => {
			if (x[0]=='('){return}
			const opt=document.createElement('option');
			opt.value=x;
			opt.textContent=x;
			select.appendChild(opt);
			}
		)			
	}
	// ordenar los option por orden alfabetico function(padre)
	sortOptions(select);
}



function sortOptions(selectElement) {
  if (!(selectElement instanceof HTMLSelectElement)) {
    console.error("El parámetro debe ser un elemento <select> válido.");
    return;
  }

  const opciones = Array.from(selectElement.options);

  opciones.sort((a, b) => {
    const textA = a.textContent.trim();
    const textB = b.textContent.trim();

    const empiezaGuionA = textA.startsWith("-");
    const empiezaGuionB = textB.startsWith("-");
    const contieneAsteriscoA = textA.includes("*");
    const contieneAsteriscoB = textB.includes("*");

    // 1️⃣ Prioridad: las que empiezan con "-"
    if (empiezaGuionA && !empiezaGuionB) return -1;
    if (!empiezaGuionA && empiezaGuionB) return 1;

    // 2️⃣ Segundo grupo: las que contienen "*"
    if (contieneAsteriscoA && !contieneAsteriscoB) return -1;
    if (!contieneAsteriscoA && contieneAsteriscoB) return 1;

    // 3️⃣ Dentro de cada grupo, ordenar alfabéticamente
    return textA.localeCompare(textB, 'es', { sensitivity: 'base' });
  });

  // Guardar la opción seleccionada
  const valorSeleccionado = selectElement.value;

  // Limpiar y volver a agregar las opciones
  selectElement.innerHTML = "";
  opciones.forEach(opt => selectElement.appendChild(opt));

  // Restaurar la selección si existía
  selectElement.value = valorSeleccionado;
}

function crearSelAreas(){
	// select
	let select=document.createElement('select');
	select.id='selector0';
	// options
	let optionDefault=document.createElement('option');
	optionDefault.value='';
	optionDefault.textContent=fsel0;
	select.appendChild(optionDefault);
	// datos del selector
	damecol(colArea).forEach(x => {
	  const opt=document.createElement('option');
	  opt.value=x;
	  opt.textContent=x;
	  select.appendChild(opt);
	});
	// evento
	select.addEventListener('change',change0);
	return select;
}

function crearSelCountry(){
	let area=document.getElementById('selector0').value;
	let select=document.getElementById('selector1'); 
	select.innerHTML='';
	// options
	let optionDefault=document.createElement('option');
	optionDefault.value='';
	optionDefault.textContent=fsel1;
	select.appendChild(optionDefault);
	// lista dinamica
	let lista='';
	//console.log('crearSelCountry:',area);
	if (area==''){
		lista=damecol(colPais);
	}else{
		lista=damecol1(colPais,colArea,area);
	}
	lista.forEach(x => {
		if (x=='.'||x=='-'){return}	
		const opt=document.createElement('option');
		opt.value=x;
		opt.textContent=x;
		select.appendChild(opt);
	});
}

function crearSelCity(){
	// para un pais dado 
	// '' todas las ciudades 
	let pais=document.getElementById('selector1').value;
	let select=document.getElementById('selector2'); 
	select.innerHTML='';
	// options
	var optionDefault=document.createElement('option');
	optionDefault.value='';
	optionDefault.textContent=fsel2;
	select.appendChild(optionDefault);
	// lista dinamica
	let lista='';
	if (pais==''){
		lista=damecol(colCiudad);
	}else{
		lista=damecol1(colCiudad,colPais,pais);
	}
	lista.forEach(x => {
	if (x=='.'||x=='-'){return}
	  const opt=document.createElement('option');
	  opt.value=x;
	  opt.textContent=x;
	  select.appendChild(opt);
	});
}

function crearSelDates(){

	let select=document.getElementById('selector4'); 
	select.innerHTML='';

	var optionDefault=document.createElement('option');
	optionDefault.value='';
	optionDefault.textContent=fsel4;
	select.appendChild(optionDefault);

	let lista=dameMeses(); // columna fechas 

	lista.forEach(x => {
		//if(x.indexOf('REG')!=-1){return} // solo anuales
		if(x==''||x=='-'){return} // no vacios		
		const opt=document.createElement('option');
		opt.value=x;
		opt.textContent=x;
		//opt.textContent=x.split(')')[1];
		select.appendChild(opt);
	});
}

function sortSet(s1){
	const a=[...s1];
	a.sort();
	const s2=new Set(a);
	return s2;
}

function dameMeses(){
	const m=new Set();
	m.add('JAN');
	m.add('FEB');
	m.add('MAR');
	m.add('APR');
	m.add('MAY');
	m.add('JUN');
	m.add('JUL');
	m.add('AGO');
	m.add('SEP');
	m.add('OCT');
	m.add('NOV');
	m.add('DEC');
	return m;
}

function damecol3(){
	// dame los valores sin repetir de col con col1=v1 y col2=v2

	let col=colFecha; // columna salida de fechas
	let v1=document.getElementById('selector1').value; 
	let v2=document.getElementById('selector2').value; 	
	let s3=document.getElementById('selector3'); // event *
	let v3=s3.options[s3.selectedIndex].innerText;  
	let col1=colPais;
	let col2=colCiudad;
	let col3=colTipo;
	
	const set=new Set();
	for (i=0;i<datos.length;i++){
		//console('colcol:',i,datos[i][col1],v1,datos[i][col2],v2);
		if(v1=='all' || v1=='' || datos[i][col1]==v1){
			if(v2=='all' || v2=='' || datos[i][col2]==v2){
				if(v3==fsel3 || v3=='' || datos[i][col3].indexOf(v3)!=-1 ){	
					let x=datos[i][col];
		//console('CSD:',datos[i][col3],'-',v3);					
					if (x==''){continue}
						
					if (x[0]=='.'){ // no mes
						z=x.substr(1,x.length-1); 
					}else{ // mes
						//let y=(x.split(')')[1]).split(' ')[0];
						let y=x.split(' ')[0];
						z=y;					
					}
					if (z==''){continue}
					set.add(z); 
				}
			}
		}
	}
	return sortSet(set);
}

function damecol2(col){
	// dame los valores sin repetir de col con la entrada col1=v1 y col2=v2
	

	let v1=document.getElementById('selector1').value; 
	let v2=document.getElementById('selector2').value; 	
	let col1=colPais;
	let col2=colCiudad;
	
	const set=new Set();
	for (i=0;i<datos.length;i++){
		//console('colcol:',i,datos[i][col1],v1,datos[i][col2],v2);
		if(v1=='all' || v1=='' || datos[i][col1]==v1){
			if(v2=='all' || v2=='' || datos[i][col2]==v2){
				let valor=datos[i][col].split(',');
				for (let k=0;k<valor.length;k++){
					if (valor[k]!=''){
						set.add(valor[k]);          
					}
				}
			}
		}
	}
	//console('col2 ',set);
	return sortSet(set);
}

function damecol1(col,col1,v1){
	// dame los valores sin repetir de col con col1=v1
	const set=new Set();
	for (i=0;i<datos.length;i++){
		if(v1=='all' || datos[i][col1]==v1){
			let valor=datos[i][col];
			if (valor!=''){
				set.add(valor);          
			}
		}
	}
	//console(set);
	return sortSet(set);
}


function damecol(col1){
  const set=new Set();
  for (i=0;i<datos.length;i++){ 
 	let linea=datos[i][col1];
      if (linea!=''){ // cadena vacia
		let primer=linea.split(' ');
		let valor=primer[0];    
		set.add(valor);          
      }
  }
	return sortSet(set);
}

function getObj(i){
	let o={
			pais:datos[i][colPais],
			ciudad:datos[i][colCiudad],
			tipo:datos[i][colTipo],
			nombre:datos[i][colNombre],
			autor:datos[i][colAutor],
			fechas:datos[i][colFecha],
			url:datos[i][colUrl],
      }
      return o;
}

function damelista(pais){
// para un pais dado dame la lista de datos con un array de objetos
	res=[];
	for (i=0;i<datos.length;i++){
		if (pais==datos[i][colPais]){
			//let fecha=datos[i][4].split(' ')[0];
			//let fecha=linea[0];
		      res.push(getObj(i));
		}
	}
	return res.sort();
}

function change0(e){
	crearSelCountry(); 	
	crearSelCity(); 
	crearSelType();
	if (app!='people'){crearSelDates()}
	renderGo();
}

function change1(e){
	crearSelCity(); 
	crearSelType();
	if (app!='people'){crearSelDates()}
	renderGo();
}

function change2(e){
	crearSelType();
	if (app!='people'){crearSelDates()}
	renderGo();
}

function change3(e){
	if (app!='people'){crearSelDates()}
	renderGo();
}

function change4(e){
	renderGo();
}

function change5(e){
// apagar encender selectores segun el tipo de la vista
	crearSelType(); // cada vista es distinto
	const s5=document.getElementById('selector5').value;
	if (s5=='-view'){
		window.location.href = '?'; // carga desde cero
	}
	if (s5=='annual'){
		// apagar selectores
		document.getElementById('selector1').style.display='none';
		document.getElementById('selector2').style.display='none';
		//document.getElementById('selector3').style.display='none';
		document.getElementById('selector4').style.display='';
	}
	if (s5=='countries'){
		document.getElementById('selector1').style.display='';
		document.getElementById('selector2').style.display='';
		//document.getElementById('selector3').style.display='block';
		document.getElementById('selector4').style.display='';	
	}
	if (s5=='otra'){
		// puedo cargar la pagina otra vez con los parametros
		window.location.href = '?app=mundo&view=annual&area=Asia&pais=Korea&ciudad=Seoul';
	}
	renderGo();
}

function renderGo(){
	// usar solo los selectores visibles
	let s0=document.getElementById('selector0').value;
	let s1=document.getElementById('selector1').value; 
	let s2=document.getElementById('selector2').value;
	let s3=document.getElementById('selector3').value;
	let s4;
	let s5;
	if (document.getElementById('selector1').style.display=='none'){s1=''}
	if (document.getElementById('selector2').style.display=='none'){s2=''}
	if (!document.getElementById('selector4')){s4=''}else{
		if (document.getElementById('selector4').style.display=='none'){s4=''}			
		s4=document.getElementById('selector4').value;
	}
	if (!document.getElementById('selector5')){s5=''}else{
		if (document.getElementById('selector5').style.display=='none'){s5=''}			
		s5=document.getElementById('selector5').value;
	}

	//console.log('renderGo:',s5);
	render(s0,s1,s2,s3,s4,s5);
}

function filtra(cadena1,cadena2){
	// ver si cada palabra de lista1 esta en cadena2
	let lista1=cadena1.split(',');
	for (x of lista1){
		if (cadena2.indexOf(x)!=-1){
			return 1; // encontro
		}
	}
	return -1; // no encontro
}

function borraTxt(cadena, palabrasAEliminar){
// borrar texto de una lista elementos separados por comas
  // Convertir las cadenas en arrays, quitando espacios innecesarios
  const lista = cadena.split(',').map(p => p.trim()).filter(p => p);
  const eliminar = palabrasAEliminar.split(',').map(p => p.trim()).filter(p => p);

  // Filtrar las palabras que NO estén en la lista de eliminación
  const resultado = lista.filter(p => !eliminar.includes(p));

  // Volver a unir en una cadena separada por comas
  return resultado.join(',');
}


function renderCountries(s0,s1,s2,s3,s4){

	const results=document.getElementById('resultados');  
	results.innerHTML=''; // borrar el listado
	results.style.fontSize='12px';
	let contadorL1=0;
	// filtro area y pais
	const area=s0;	
	if (area==''){
		var lista=(s1==''||s1=='all') ? damecol(colPais) : [s1];		
	}else{
		var lista=(s1==''||s1=='all') ? damecol1(colPais,colArea,area) : [s1];		
	}

	var sumario=document.createElement('div');
	sumario.id='sumario';
	results.appendChild(sumario);	

	for (const area of lista) {
		const entradas=damelista(area);	
		if (entradas.length==0){continue}
		//console.log('L1:',contadorL1);

		// Título del país
		var header=document.createElement('li');
		header.style.listStyleType='none'; // change lista    
		header.innerHTML=area;
		header.style.fontWeight='bold';
		results.appendChild(header);

		let a3=s3.split(','); // incluye listas de tipos
		var contadorL2=0;

		for (const item of entradas) {
			// filtro dates
			if (
			      s4!='' &&
			      s4!='all' &&
			      (item.fechas.indexOf(s4)==-1) 
			){continue}   

			// filtro type ahora un array
			// app=people usar colFecha
			// app!=people usar colTipo
			let selector='';
			if (app=='people'){
				selector=item.fechas;	
			}else{
				selector=item.tipo;				
			}

			if (
			      s3!='' &&
			      s3!='all' &&
			      (filtra(s3,selector)==-1)
			){continue}    

			// filtro ciudad
			if (
			      s2!='' &&
			      s2!='all' &&
			      s2!=item.ciudad
			){continue}

			contadorL2+=1; // linea de nivel2
			contadorL1+=1;
			// ciudad nivel2 				
			var li=document.createElement('li');
			li.style.listStyleType='circle'; // change lista    
			li.style.marginLeft='10px';

			// Mostrar texto plano y enlace separado
			const span=document.createElement('span');
			li.appendChild(span);			


			let span1='';
			if (item.tipo!=''&&item.tipo!='-'){			
				//if (app!='people'){// no mostrar
				//	item.tipo=borraTxt(item.tipo,ocultar); // CEP,HLP,TRY				
				//}
				let color=colorTipo.get(item.tipo);
				//if (color==undefined){color='#DDD'}
				let clase="stipo";
				if (app=='people'){clase=''}
				span1='<span class="'+clase+'" style="background-color:'+color+
				'">'+item.tipo+'</span>';
			}

			let span2='';
			if (item.ciudad!=''){
				span2='<div class="sCity">'+item.ciudad+'&nbsp;</div>';
			}
			
			let span3='';
			if (item.autor!=''&&item.autor!='-'){
				span3='<div class="itemLinea">'+item.autor+'&nbsp;</div>';
			}
			
			let span4='';
			if (item.fechas!=''&&item.fechas!='-'){
				span4='<div class="itemLinea">'+item.fechas+'&nbsp;</div>';
			}

			if (app=='people'){
				item.texto=span2+' : '+item.nombre+' : '+span1.replace('event ','')+
				' : '+span3+' : '+span4;
				span.innerHTML=item.texto;	
			}else{
				item.texto=span2+span1.replace('event ','')+
				'&nbsp;:&nbsp;'+item.nombre+'&nbsp;:&nbsp;'+span3+span4;
				span.innerHTML=item.texto;	
			}

			if (item.url!=''&&item.url!='-') {
				const spot=document.createTextNode(' ');
				li.appendChild(spot);

				const link=document.createElement('a');
				link.href=item.url;
				  link.innerHTML='<img class="iconoUrl" src="img/a2.png">';//icono
				//link.innerHTML='&#128640;';//cohete
				link.target='_blank';
				li.appendChild(link);
			}

			resultados.appendChild(li);				
		}
		header.innerHTML+='<span id="cuenta">&nbsp;('+contadorL2+')</span>';
	
		if (contadorL2==0){
			// este grupo esta vacio, borrar la linea
			header.parentNode.removeChild(header);
		}		
	}
	resultados.innerHTML+='<br/><br/>';
	return contadorL1;
}

function entrarTipo(){
//console.log('entrarTipo',this.innerHTML.length);
let lon=this.innerHTML.length
if (lon>10){
	this.style.width=(lon*9)+'px';
	//this.style.position='absolute';
}
}
function salirTipo(){
	this.style.width='90px';
	//this.style.position='';	
}

let meses=['JAN','FEB','MAR','APR','MAY','JUN','JUL','AGO','SEP','OCT','NOV','DEC'];

/*
function renderAnnual(s1,s2,s3,s4){
	//console('render',s1,s2);
	const results=document.getElementById('resultados'); 
	results.style.fontSize='16px';	
	results.innerHTML=checkTxt;
	

	let contadorL1=0;
	// listado completo
	// para un pais dado,lista de datos coko array de objetos
	
	var sumario=document.createElement('div');
	sumario.id='sumario';
	results.appendChild(sumario);	
	
	entradas=[];
	for (i=0;i<datos.length;i++){
		console.log('M123',i);
		let fechas=datos[i][5];
		if ( fechas=='' || fechas[0]=='.' || fechas=='-' ){continue}
		//let fecha=datos[i][4].split(' ')[0];
		//let fecha=linea[0];
		let o=getObj(i); // datos de la linea
		//console('fechas:',o.fechas);

		const actual=new Date(); // hoy
		//let y1=actual.getFullYear();
		const year=o.fechas.split('.')[1];
		const mes=parseInt(o.fechas.substr(1,2))-1;
		//console.log('error:',o.nombre,' ',o.fechas);
		const dia=o.fechas.split(' ')[1].split('-')[0];
		// poner año a los eventos y calcular si paso la fecha completa o no (11)NOV 22-25.2024
		const f2=new  Date(year,mes,dia); // fecha del evento		
		if (f2<actual){year++} // si ya paso el evento sumar un año para el próximo
		f3=new Date(year,mes,dia); 
		o.ofecha=f3;
		o.pfecha=f3.getFullYear()+'-'+meses[f3.getMonth()]+'-'+dia.toString().padStart(2, '0'); // texto en listado
		console('M123:',o.nombre,f3);
		entradas.push(o);
	  }
	  //entradas.sort(); // ordenar por fechas
	entradas.sort(function(a, b){return a.ofecha-b.ofecha})	  
	
	let a3=s3.split(','); // incluye listas de tipos
	for (const item of entradas) {    
		// filtro dates
		if (
		      s4!='' &&
		      s4!='all' &&
		      (item.fechas.indexOf(s4)==-1) 
		){continue}   

		// filtro type
		if (
		      s3!='' &&
		      s3!='all' &&
		      (a3.indexOf(item.tipo)==-1)
		      //s3!=item.tipo
		){continue}    

		// filtro ciudad
		if (
		      s2!='' &&
		      s2!='all' &&
		      s2!=item.ciudad
		){continue}
		
		// filtro pais
		if (
		      s1!='' &&
		      s1!='all' &&
		      s1!=item.pais
		){continue}		

		//contadorL2+=1; // linea de nivel2
		contadorL1+=1;
		// ciudad nivel2 
		const li=document.createElement('li');
		li.style.listStyleType='circle'; // change lista    
		li.style.marginLeft='20px';

		// Mostrar texto plano y enlace separado
		const span=document.createElement('span');
		span1='';
		if (item.tipo!=''){
			span1='<span class="stipo2" style="background-color:'+colorTipo.get(item.tipo)+
			'">'+item.tipo+'&nbsp;</span>';
		}
		span2='';
		if (item.autor!=''){
			span2='<br/>organizer: '+item.autor;
		}
		
		item.texto=item.pfecha+'&nbsp;'+span1.replace('event','')+'&nbsp;'+item.nombre+
		span2+'<br/>'+'where: '+item.ciudad+', '+item.pais+'&nbsp;:';
		span.innerHTML=item.texto;
		li.appendChild(span);

		if (item.url) {
			const spot=document.createTextNode(' ');
			li.appendChild(spot);

			const link=document.createElement('a');
			link.href=item.url;
			link.innerHTML='link-info';
			link.target='_blank';
			li.appendChild(link);
		}
		resultados.appendChild(li);
		resultados.innerHTML+='<br/>';
	}
	resultados.innerHTML+='<br/><br/>';	
	return contadorL1;
}
*/

function renderAnnualCompact(s0,s1,s2,s3,s4){
	console.log('M123','render');
	const colorMes=[
	'#BFD7EA', 
	'#E8C2CA', 
	'#B4E197', 
	'#F7E1D7', 
	'#FFF1B5',  
	'#FFD6A5', 
	'#FFB3B3',  
	'#F6D7B0',  
	'#D0E6A5',  
	'#E7BFB1',  
	'#D1BFA7',  
	'#C6D8FF'   
	];

	////console('render',s1,s2);
	const results=document.getElementById('resultados'); 
	results.style.fontSize='12px';	
	results.innerHTML=checkTxt;
	
	let contadorL1=0;
	// listado completo
	// para un pais dado,lista de datos coko array de objetos
	entradas=[];

	const area=s0;
	var sumario=document.createElement('div');
	sumario.id='sumario';
	results.appendChild(sumario);
	for (let i=0;i<datos.length;i++){
	
		// filtro area
		if (
		      s0!='' &&
		      s0!='all' &&
		      (datos[i][colArea]!=s0) 
		){continue} 
		
		let o=getObj(i);	
		//let fechas=datos[i][colFecha];
		let fechas=o.fechas;
		if ( fechas=='-' || fechas=='' || fechas[0]=='.' || fechas[0]!='(' ){continue} // no hay fecha me salto la linea

		
		//console.log('fechas:',i,datos[i][colFecha],o.fechas,o.fechas.split(' ')[1]);
	
		const actual=new Date(); // hoy
		let y1=actual.getFullYear(); // año actual
		let year=o.fechas.split('.')[1]; // año entrada
		const mes=parseInt(o.fechas.substr(1,2))-1; // mes entrada
		const dia=o.fechas.split(' ')[1].split('-')[0]; // dia entrada
		// si evento es anterior reprogramarlo despues de actual
		// dos veces segun el mes donde antes o despues del actual
		var f2=new Date(year,mes,dia); // fecha entrada		
		if (f2.getTime()<actual.getTime()){year=y1}
		var f2=new Date(year,mes,dia); // fecha entrada		
		if (f2.getTime()<actual.getTime()){year++} 
		f3=new Date(year,mes,dia); // fecha evento despues de actual
		// salvar datos en el objeto
		o.ofecha=f3;
		o.colorMes=mes;
		o.pfecha=f3.getFullYear()+'.'+meses[f3.getMonth()]+'-'+dia.toString().padStart(2, '0');		
		o.pfecha2='&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'+dia.toString().padStart(2, '0');
		//console(f2,mes,dia,o.ofecha);
		entradas.push(o);
	}
	// ordenar por fechas
	entradas.sort(function(a, b){return a.ofecha-b.ofecha})	  

	let a3=s3.split(','); // incluye listas de tipos
	var mesAnterior=-1;
	for (const item of entradas) {    
		// filtro dates, buscar el mes
		if (
		      s4!='' &&
		      s4!='all' &&
		      (item.fechas.indexOf(s4)==-1) 
		){continue}   

		// filtro type
		if (
		      s3!='' &&
		      s3!='all' &&
		      (a3.indexOf(item.tipo)==-1)
		      //s3!=item.tipo
		){continue}    

		// filtro ciudad
		if (
		      s2!='' &&
		      s2!='all' &&
		      s2!=item.ciudad
		){continue}
		
		// filtro pais
		if (
		      s1!='' &&
		      s1!='all' &&
		      s1!=item.pais
		){continue}		

		//contadorL2+=1; // linea de nivel2
		contadorL1+=1;
		// ciudad nivel2 
		const li=document.createElement('li');
		li.style.listStyleType='circle'; // change lista    
		li.style.marginLeft='20px';

		// Mostrar texto plano y enlace separado
		const span=document.createElement('span');

		span1=''; // tipo
		if (item.tipo!=''){
			span1='<span class="stipo3" style="color:#444;background-color:'+colorTipo.get(item.tipo)+
			'">'+item.tipo+'&nbsp;</span>';
		}
		
		let span2=''; // autor
		if (item.autor!='') {
			span2='<span>'+item.autor+'</span>';	
		}		

		// fecha
		if(item.colorMes==mesAnterior){
			var fff=item.pfecha2;
		}else{
			var fff=item.pfecha;
		}
		mesAnterior=item.colorMes;		
		
		let span3='';
		if (item.pfecha!='') {
			span3='<span class="fechaCompacta" style="background-color:'+colorMes[item.colorMes]+
			'">'+fff+'</span>';	
		}	
		
		// linea para imprimir
		item.texto=span3+span1.replace('event ','')+'&nbsp;<span>'+item.nombre+'</span>&nbsp;('+
		item.ciudad+','+item.pais+')';
		span.innerHTML=item.texto;
		li.appendChild(span);

		if (item.url) {
			const spot=document.createTextNode(' ');
			li.appendChild(spot);
			const link=document.createElement('a');
			link.href=item.url;
			link.innerHTML='<img class="iconoUrl" src="img/a2.png">';//icono
			//link.innerHTML='&#128640;';//cohete
			link.target='_blank';
			li.appendChild(link);
		}

		resultados.appendChild(li);
		/*
		let ele=span.getElementsByTagName('span')[2]; // hijo 3 nombre
		
		if (item.autor!=''){
			ele.style.cursor='pointer';
			ele.txt1=item.nombre;
			ele.txt2=item.autor;	
			ele.txt0='nombre';		
			ele.addEventListener('click',alterno);
		}
		*/
		
		/*
		header.innerHTML+='<span id="cuenta">&nbsp;('+contadorL2+')</span>';
		if (contadorL2==0){
			// esta vacio, borrar la linea
			header.parentNode.removeChild(header);
		}
		*/
	}
	resultados.innerHTML+='<br/><br/>';	
	return contadorL1;
}


function renderAnnualCompact2(s1,s2,s3,s4){

	const colorMes=[
		'#BFD7EA', 
		'#E8C2CA', 
		'#B4E197', 
		'#F7E1D7', 
		'#FFF1B5',  
		'#FFD6A5', 
		'#FFB3B3',  
		'#F6D7B0',  
		'#D0E6A5',  
		'#E7BFB1',  
		'#D1BFA7',  
		'#C6D8FF'   
	];

	////console('render',s1,s2);
	const results=document.getElementById('resultados'); 
	results.style.fontSize='12px';	
	results.innerHTML=checkTxt;
	
	let contadorL1=0;
	// listado completo
	// para un pais dado,lista de datos coko array de objetos
	 entradas=[];
	 for (i=0;i<datos.length;i++){
		let fechas=datos[i][colFecha];
		if (fechas=='' || fechas[0]=='.'){continue}
		let o=getObj(i);
		//console('fechas:',o.fechas);
	
		const actual=new Date();
		let y1=actual.getFullYear();
		const year=o.fechas.split('.')[1];
		const mes=parseInt(o.fechas.substr(1,2))-1;
		////console.log('error:',o.nombre,' ',o.fechas);
		const dia=o.fechas.split(' ')[1].split('-')[0];
		// poner año a los eventos y calcular si paso la fecha completa o no (11)NOV 22-25.2024
		const f2=new  Date(year,mes,dia);		
		if (f2<actual){y1++} // ya es el año que viene
		f3=new Date(y1,mes,dia); // cuando se supone que es el evento
		o.ofecha=f3;
		o.colorMes=mes;
		o.pfecha=f3.getFullYear()+'-'+meses[f3.getMonth()]+'-'+dia.toString().padStart(2, '0');
		//console(f2,mes,dia,o.ofecha);
		entradas.push(o);
	}
	  //entradas.sort(); // ordenar por fechas
	entradas.sort(function(a, b){return a.ofecha-b.ofecha})	  

	let a3=s3.split(','); // incluye listas de tipos
	for (const item of entradas) {    
		// filtro dates
		if (
		      s4!='' &&
		      s4!='all' &&
		      (item.fechas.indexOf(s4)==-1) 
		){continue}   

		// filtro type
		if (
		      s3!='' &&
		      s3!='all' &&
		      (a3.indexOf(item.tipo)==-1)
		      //s3!=item.tipo
		){continue}    

		// filtro ciudad
		if (
		      s2!='' &&
		      s2!='all' &&
		      s2!=item.ciudad
		){continue}
		
		// filtro pais
		if (
		      s1!='' &&
		      s1!='all' &&
		      s1!=item.pais
		){continue}		

		//contadorL2+=1; // linea de nivel2
		contadorL1+=1;
		// ciudad nivel2 
		const li=document.createElement('li');
		li.style.listStyleType='circle'; // change lista    
		li.style.marginLeft='20px';

		// Mostrar texto plano y enlace separado
		const span=document.createElement('span');
		span1='';
		if (item.tipo!=''){
			span1='<span class="stipo3" style="background-color:'+colorTipo.get(item.tipo)+
			'">'+item.tipo+'&nbsp;</span>';
		}
		
		let span2=''; // si hay autor poner icono 
		if (item.autor!='') {
			span2='<span class="datos">&nbsp;&#128203;</span>';	
		}		
		
		let span3='';
		if (item.pfecha!='') {
			span3='<span style="color:#444;background-color:'+colorMes[item.colorMes]+
			'">'+item.pfecha+'</span>';	
		}		
		
		//console('span1',span1);
		item.texto=span3+'&nbsp;'+span1.replace('event','')+'&nbsp;'+
		item.pais+','+item.ciudad+':&nbsp;<span>'+item.nombre+'</span>'+span2+
		':';
		span.innerHTML=item.texto;
		li.appendChild(span);

		if (item.url) {
			const spot=document.createTextNode(' ');
			li.appendChild(spot);

			const link=document.createElement('a');
			link.href=item.url;
			  link.innerHTML='<img class="iconoUrl" src="img/a2.png">';//icono
			//link.innerHTML='&#128640;';//cohete
			link.target='_blank';
			li.appendChild(link);
		}
		resultados.appendChild(li);
		let ele=span.getElementsByTagName('span')[2]; // hijo 3 nombre
		if (item.autor!=''){
			ele.style.cursor='pointer';
			ele.txt1=item.nombre;
			ele.txt2=item.autor;	
			ele.txt0='nombre';		
			ele.addEventListener('click',alterno);
		}
		
		/*
		header.innerHTML+='<span id="cuenta">&nbsp;('+contadorL2+')</span>';
		if (contadorL2==0){
			// esta vacio, borrar la linea
			header.parentNode.removeChild(header);
		}
		*/
	}
	return contadorL1;
}

function alterno(){
	const el=this;
	let txt='';
	if (el.txt0=='nombre'){
		el.txt0='autor';
		txt=el.txt2;
		el.style.backgroundColor='#CCC';
	}else{
		el.txt0='nombre';
		txt=el.txt1;
		el.style.backgroundColor='#FFF';		
	}
	el.innerHTML=txt;
}

function render(s0,s1,s2,s3,s4,s5){
	console.log('render: ',s0,s1,s2,s3,s4,s5);
	if (s5==fsel5||s5==''){s5='countries'}// por defecto
	if (s5=='countries'){var contadorL1=renderCountries(s0,s1,s2,s3,s4);}
	//if (s5=='detail'){var contadorL1=renderAnnualCompact2(s0,s1,s2,s3,s4);}
	if (s5=='annual'){var contadorL1=renderAnnualCompact(s0,s1,s2,s3,s4);}
	const sumario=document.getElementById('sumario');
	sumario.innerHTML='&#128202;<i>'+' total</i> ('+contadorL1+')<br/><br/>';    
	//resultados.appendChild(sumario); 
}
//console('end main');
window.onload=inicio;

</script>
</head>
<body>
</body>
</html>
